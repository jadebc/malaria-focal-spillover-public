
R version 4.0.2 (2020-06-22) -- "Taking Off Again"
Copyright (C) 2020 The R Foundation for Statistical Computing
Platform: x86_64-pc-linux-gnu (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

  Natural language support but running in an English locale

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> ################################################
> # Spillover effects of reactive, focal malaria 
> # interventions
> 
> # Namibia trial
> # Primary analysis: incidence
> ################################################ 
> rm(list=ls())
> library(sl3)
> library(tmle3)
> library(origami)
origami v1.0.5: Generalized Framework for Cross-Validation
> library(SuperLearner)
Loading required package: nnls
Loading required package: gam
Loading required package: splines
Loading required package: foreach
Loaded gam 1.20

Super Learner
Version: 2.0-28
Package created on 2021-05-04

> library(glmnet)
Loading required package: Matrix
Loaded glmnet 4.1-2
> library(gam)
> library(xgboost)
> library(GGally)
Loading required package: ggplot2
Registered S3 method overwritten by 'GGally':
  method from   
  +.gg   ggplot2
> 
> source(paste0(here::here(), "/0-config.R"))
Loading required package: sp
Please note that rgdal will be retired by the end of 2023,
plan transition to sf/stars/terra functions using GDAL and PROJ
at your earliest convenience.

rgdal: version: 1.5-28, (SVN revision 1158)
Geospatial Data Abstraction Library extensions to R successfully loaded
Loaded GDAL runtime: GDAL 3.4.1, released 2021/12/27
Path to GDAL shared files: /share/software/user/open/gdal/3.4.1/share/gdal
GDAL binary built with GEOS: FALSE 
Loaded PROJ runtime: Rel. 8.2.1, January 1st, 2022, [PJ_VERSION: 821]
Path to PROJ shared files: /home/users/jadebc/.local/share/proj:/share/software/user/open/proj/8.2.1/share/proj:/share/software/user/open/proj/8.2.1/share/proj
PROJ CDN enabled: FALSE
Linking to sp version:1.4-5
To mute warnings of possible GDAL/OSR exportToProj4() degradation,
use options("rgdal_show_exportToProj4_warnings"="none") before loading sp or rgdal.

Attaching package: ‘tidyr’

The following objects are masked from ‘package:Matrix’:

    expand, pack, unpack


Attaching package: ‘lubridate’

The following objects are masked from ‘package:base’:

    date, intersect, setdiff, union


Attaching package: ‘reshape2’

The following object is masked from ‘package:tidyr’:

    smiths


Attaching package: ‘purrr’

The following objects are masked from ‘package:foreach’:

    accumulate, when


Attaching package: ‘data.table’

The following object is masked from ‘package:purrr’:

    transpose

The following objects are masked from ‘package:reshape2’:

    dcast, melt

The following objects are masked from ‘package:lubridate’:

    hour, isoweek, mday, minute, month, quarter, second, wday, week,
    yday, year


Attaching package: ‘dplyr’

The following objects are masked from ‘package:data.table’:

    between, first, last

The following object is masked from ‘package:xgboost’:

    slice

The following objects are masked from ‘package:stats’:

    filter, lag

The following objects are masked from ‘package:base’:

    intersect, setdiff, setequal, union

> 
> # load data ---------------------------------------
> data_mosq_list <- readRDS(namibia_mosq_process_path)
> 
> # load covariate list ---------------------------------------
> covarname <- readRDS(namibia_inc_covar_path)
> covarname_g = c("pre_spray_cover", "pre_incidence", "pre_rainfall",
+                 "pop_size_ea","pre_evi", "ea_elevation","surface_temp")
> covarname_Q = covarname[!covarname %in% c(covarname_g)]
> 
> # SuperLearner set up ---------------------------------------
> source(paste0(here::here(), '/2-analysis/0-namibia-incidence-learners.R'))
> 
> # Run hTMLE - Total effect ---------------------------------------
> 
> res_total_mosq <- list()
> 
> ## Mosquito ---------------------------------------
> tic()
> set.seed(123)
> res_total_mosq <- lapply(data_mosq_list, function(x)
+   run_hTMLE(df = x,
+             effecttype = 'total',
+             Qlevel = "individual", # cohort/individual/adaptive for incidence, individual for prev
+             glevel = "cohort", # always cohort for incidence, individual for prev
+             dependency = TRUE, # TRUE if we want CIs adjusted for dependency
+             unadj_est = FALSE, # TRUE if we want a unadjusted estimate
+             y_l = 0,
+             y_u = 1,
+             covarname_g = covarname_g,    # set of names for adjustment variables
+             covarname_Q = covarname_Q,
+             SL_lib_Q = SL_lib_Q,
+             SL_lib_g = SL_lib_g,
+             SL_lib_adaQ = SL_lib_simple, # need to specify if for Qlevel = "adaptive"
+             SL_lib_depen = SL_lib_simple, # need to specify if dependency = T
+             verbose = FALSE,
+             reservoir_name = "Mosquito")
+ )
[1] "Fitting htmle model ======================================="
[1] "Covariate screening ---------------------------------"
Loading required package: lmtest
Loading required package: zoo

Attaching package: ‘zoo’

The following objects are masked from ‘package:base’:

    as.Date, as.Date.numeric


Likelihood Ratio Test P-values:
                P-value
pre_spray_cover 0.06814
pre_incidence   0.00000
pre_rainfall    0.00000
pop_size_ea     0.00000
pre_evi         0.00000
ea_elevation    0.00000
surface_temp    0.00000


Covariates selected (P<0.2):
                      P-value
pre_spray_cover  6.814085e-02
pre_incidence   1.680177e-310
pre_rainfall    1.313515e-114
pop_size_ea     5.580401e-211
pre_evi          1.774261e-55
ea_elevation    9.973706e-139
surface_temp    5.327948e-136
[1] "===== variables excluded after lmtest ===== "
character(0)
[1] "===== variables excluded after sparsity check ===== "
character(0)
[1] "===== excluded constant variables ===== "
character(0)
[1] "===== variables selected in the end ===== "
[1] "pre_spray_cover" "pre_incidence"   "pre_rainfall"    "pop_size_ea"    
[5] "pre_evi"         "ea_elevation"    "surface_temp"   

Likelihood Ratio Test P-values:
                         P-value
dist_to_index            0.09842
pop_500m                 0.00001
pop_1km                  0.00000
pop_2km                  0.00000
pop_3km                  0.06329
sex                      0.00000
dist_hh                  0.00816
dist_hf                  0.00000
pop_size_cohort          0.86815
Ntx                      0.00000
tx_cov_cohort            0.13689
high_season              0.00013
prop_prev_tx             0.00000
pre_int_3000             0.00000
pre_int_2000             0.00000
pre_int_1000             0.00000
pre_int_500              0.00000
n_int_pre_recei          0.00000
pre_int_propdiffarm_500  0.00006
pre_int_propdiffarm_1000 0.00000
pre_int_propdiffarm_2000 0.02124
pre_int_propdiffarm_3000 0.00000
age                      0.00685
delta_age                0.00000
response_time            0.00000
delta_response_time      0.81587
delta_age.1              0.00000
delta_response_time.1    0.81587
delta_dist_index_quant   0.05343


Covariates selected (P<0.2):
                               P-value
dist_to_index             9.841642e-02
pop_500m                  1.364167e-05
pop_1km                   2.692730e-07
pop_2km                   1.939976e-08
pop_3km                   6.329189e-02
sex                       3.690750e-11
dist_hh                   8.161177e-03
dist_hf                   2.004958e-26
Ntx                       6.443241e-16
tx_cov_cohort             1.368906e-01
high_season               1.299488e-04
prop_prev_tx              1.088252e-84
pre_int_3000              1.919230e-20
pre_int_2000              1.857553e-18
pre_int_1000              1.915904e-73
pre_int_500               3.658972e-31
n_int_pre_recei           3.429248e-80
pre_int_propdiffarm_500   5.599575e-05
pre_int_propdiffarm_1000  1.888926e-29
pre_int_propdiffarm_2000  2.124056e-02
pre_int_propdiffarm_3000  1.176811e-10
age                       6.847527e-03
delta_age                1.126148e-206
response_time             2.047902e-64
delta_age.1              1.126148e-206
delta_dist_index_quant    5.343495e-02
[1] "===== variables excluded after lmtest ===== "
[1] "pop_size_cohort"     "delta_response_time"
[1] "===== variables excluded after sparsity check ===== "
[1] "pre_int_propdiffarm_500"
[1] "===== excluded constant variables ===== "
character(0)
[1] "===== variables selected in the end ===== "
 [1] "dist_to_index"            "pop_500m"                
 [3] "pop_1km"                  "pop_2km"                 
 [5] "pop_3km"                  "sex"                     
 [7] "dist_hh"                  "dist_hf"                 
 [9] "Ntx"                      "tx_cov_cohort"           
[11] "high_season"              "prop_prev_tx"            
[13] "pre_int_3000"             "pre_int_2000"            
[15] "pre_int_1000"             "pre_int_500"             
[17] "n_int_pre_recei"          "pre_int_propdiffarm_1000"
[19] "pre_int_propdiffarm_2000" "pre_int_propdiffarm_3000"
[21] "age"                      "delta_age"               
[23] "response_time"            "delta_dist_index_quant"  
15.96 sec elapsed
[1] "Choose Qlevel ---------------------------------"
0 sec elapsed
[1] "Cohort-level covariate screening ---------------------------------"

Likelihood Ratio Test P-values:
                P-value
pre_spray_cover 0.04450
pre_incidence   0.02238
pre_rainfall    0.52252
pop_size_ea     0.44204
pre_evi         0.88871
ea_elevation    0.20749
surface_temp    0.61847


Covariates selected (P<0.2):
                   P-value
pre_spray_cover 0.04450377
pre_incidence   0.02238267
[1] "===== variables excluded after lmtest ===== "
[1] "pre_rainfall" "pop_size_ea"  "pre_evi"      "ea_elevation" "surface_temp"
[1] "===== variables excluded after sparsity check ===== "
character(0)
[1] "===== excluded constant variables ===== "
character(0)
[1] "===== variables selected in the end ===== "
[1] "pre_spray_cover" "pre_incidence"  

Likelihood Ratio Test P-values:
                         P-value
dist_to_index            0.23888
pop_500m                 0.06312
pop_1km                  0.56433
pop_2km                  0.03039
pop_3km                  0.77499
sex                      0.75789
dist_hh                  0.47042
dist_hf                  0.00092
pop_size_cohort          0.07290
Ntx                      0.00928
tx_cov_cohort            0.23538
high_season              0.24128
prop_prev_tx             0.00000
pre_int_3000             0.00015
pre_int_2000             0.00065
pre_int_1000             0.00001
pre_int_500              0.00005
n_int_pre_recei          0.00000
pre_int_propdiffarm_500  0.16104
pre_int_propdiffarm_1000 0.00980
pre_int_propdiffarm_2000 0.56765
pre_int_propdiffarm_3000 0.19515
age                      0.00027
delta_age                0.00001
response_time            0.00000
delta_response_time      0.39821
delta_dist_index_quant   0.72027


Covariates selected (P<0.2):
                              P-value
pop_500m                 6.311736e-02
pop_2km                  3.039112e-02
dist_hf                  9.161890e-04
pop_size_cohort          7.290189e-02
Ntx                      9.281700e-03
prop_prev_tx             7.126485e-07
pre_int_3000             1.478742e-04
pre_int_2000             6.459142e-04
pre_int_1000             9.872820e-06
pre_int_500              5.436951e-05
n_int_pre_recei          6.878773e-12
pre_int_propdiffarm_500  1.610416e-01
pre_int_propdiffarm_1000 9.800808e-03
pre_int_propdiffarm_3000 1.951474e-01
age                      2.716168e-04
delta_age                7.123845e-06
response_time            4.166657e-06
[1] "===== variables excluded after lmtest ===== "
 [1] "dist_to_index"            "pop_1km"                 
 [3] "pop_3km"                  "sex"                     
 [5] "dist_hh"                  "tx_cov_cohort"           
 [7] "high_season"              "pre_int_propdiffarm_2000"
 [9] "delta_response_time"      "delta_dist_index_quant"  
[1] "===== variables excluded after sparsity check ===== "
character(0)
[1] "===== excluded constant variables ===== "
character(0)
[1] "===== variables selected in the end ===== "
 [1] "pop_500m"                 "pop_2km"                 
 [3] "dist_hf"                  "pop_size_cohort"         
 [5] "Ntx"                      "prop_prev_tx"            
 [7] "pre_int_3000"             "pre_int_2000"            
 [9] "pre_int_1000"             "pre_int_500"             
[11] "n_int_pre_recei"          "pre_int_propdiffarm_500" 
[13] "pre_int_propdiffarm_1000" "pre_int_propdiffarm_3000"
[15] "age"                      "delta_age"               
[17] "response_time"           
[1] "hTMLE estimation ---------------------------------"
[1] "initial Qbar1W, Qbar0W: 0.012, 0.012"
[1] "updated Qbar1W, Qbar0W: 0.011, 0.013"
457.595 sec elapsed
[1] "Fitting htmle model ======================================="
[1] "Covariate screening ---------------------------------"

Likelihood Ratio Test P-values:
                P-value
pre_spray_cover 0.06814
pre_incidence   0.00000
pre_rainfall    0.00000
pop_size_ea     0.00000
pre_evi         0.00000
ea_elevation    0.00000
surface_temp    0.00000


Covariates selected (P<0.2):
                      P-value
pre_spray_cover  6.814085e-02
pre_incidence   1.680177e-310
pre_rainfall    1.313515e-114
pop_size_ea     5.580401e-211
pre_evi          1.774261e-55
ea_elevation    9.973706e-139
surface_temp    5.327948e-136
[1] "===== variables excluded after lmtest ===== "
character(0)
[1] "===== variables excluded after sparsity check ===== "
character(0)
[1] "===== excluded constant variables ===== "
character(0)
[1] "===== variables selected in the end ===== "
[1] "pre_spray_cover" "pre_incidence"   "pre_rainfall"    "pop_size_ea"    
[5] "pre_evi"         "ea_elevation"    "surface_temp"   

Likelihood Ratio Test P-values:
                         P-value
dist_to_index            0.11321
pop_500m                 0.00001
pop_1km                  0.00028
pop_2km                  0.00004
pop_3km                  0.04884
sex                      0.00000
dist_hh                  0.00000
dist_hf                  0.00000
pop_size_cohort          0.14877
Ntx                      0.00000
tx_cov_cohort            0.63036
high_season              0.00000
prop_prev_tx             0.00000
pre_int_3000             0.00000
pre_int_2000             0.00001
pre_int_1000             0.00000
pre_int_500              0.00000
n_int_pre_recei          0.00000
pre_int_propdiffarm_500  0.00095
pre_int_propdiffarm_1000 0.00000
pre_int_propdiffarm_2000 0.13945
pre_int_propdiffarm_3000 0.07917
age                      0.02744
delta_age                0.00000
response_time            0.00000
delta_response_time      0.76579
delta_age.1              0.00000
delta_response_time.1    0.76579
delta_dist_index_quant   0.34002


Covariates selected (P<0.2):
                               P-value
dist_to_index             1.132093e-01
pop_500m                  9.895218e-06
pop_1km                   2.826554e-04
pop_2km                   4.248230e-05
pop_3km                   4.883830e-02
sex                       1.062859e-06
dist_hh                   4.502242e-06
dist_hf                   6.827790e-18
pop_size_cohort           1.487742e-01
Ntx                       3.133058e-11
high_season               1.231949e-14
prop_prev_tx              5.493334e-31
pre_int_3000              7.660064e-07
pre_int_2000              1.112836e-05
pre_int_1000              1.392679e-32
pre_int_500               1.797978e-11
n_int_pre_recei           1.137255e-42
pre_int_propdiffarm_500   9.469142e-04
pre_int_propdiffarm_1000  4.577177e-21
pre_int_propdiffarm_2000  1.394515e-01
pre_int_propdiffarm_3000  7.916795e-02
age                       2.744297e-02
delta_age                1.157726e-137
response_time             1.294614e-42
delta_age.1              1.157726e-137
[1] "===== variables excluded after lmtest ===== "
[1] "tx_cov_cohort"          "delta_response_time"    "delta_dist_index_quant"
[1] "===== variables excluded after sparsity check ===== "
[1] "pre_int_propdiffarm_500"
[1] "===== excluded constant variables ===== "
character(0)
[1] "===== variables selected in the end ===== "
 [1] "dist_to_index"            "pop_500m"                
 [3] "pop_1km"                  "pop_2km"                 
 [5] "pop_3km"                  "sex"                     
 [7] "dist_hh"                  "dist_hf"                 
 [9] "pop_size_cohort"          "Ntx"                     
[11] "high_season"              "prop_prev_tx"            
[13] "pre_int_3000"             "pre_int_2000"            
[15] "pre_int_1000"             "pre_int_500"             
[17] "n_int_pre_recei"          "pre_int_propdiffarm_1000"
[19] "pre_int_propdiffarm_2000" "pre_int_propdiffarm_3000"
[21] "age"                      "delta_age"               
[23] "response_time"           
13.385 sec elapsed
[1] "Choose Qlevel ---------------------------------"
0 sec elapsed
[1] "Cohort-level covariate screening ---------------------------------"

Likelihood Ratio Test P-values:
                P-value
pre_spray_cover 0.04450
pre_incidence   0.02238
pre_rainfall    0.52252
pop_size_ea     0.44204
pre_evi         0.88871
ea_elevation    0.20749
surface_temp    0.61847


Covariates selected (P<0.2):
                   P-value
pre_spray_cover 0.04450377
pre_incidence   0.02238267
[1] "===== variables excluded after lmtest ===== "
[1] "pre_rainfall" "pop_size_ea"  "pre_evi"      "ea_elevation" "surface_temp"
[1] "===== variables excluded after sparsity check ===== "
character(0)
[1] "===== excluded constant variables ===== "
character(0)
[1] "===== variables selected in the end ===== "
[1] "pre_spray_cover" "pre_incidence"  

Likelihood Ratio Test P-values:
                         P-value
dist_to_index            0.73455
pop_500m                 0.02962
pop_1km                  0.56529
pop_2km                  0.17163
pop_3km                  0.38169
sex                      0.58100
dist_hh                  0.20229
dist_hf                  0.00347
pop_size_cohort          0.04243
Ntx                      0.01804
tx_cov_cohort            0.24851
high_season              0.00254
prop_prev_tx             0.00065
pre_int_3000             0.00480
pre_int_2000             0.01620
pre_int_1000             0.00138
pre_int_500              0.00500
n_int_pre_recei          0.00000
pre_int_propdiffarm_500  0.17763
pre_int_propdiffarm_1000 0.01395
pre_int_propdiffarm_2000 0.71179
pre_int_propdiffarm_3000 0.99325
age                      0.00016
delta_age                0.00001
response_time            0.00001
delta_response_time      0.34430
delta_dist_index_quant   0.85671


Covariates selected (P<0.2):
                              P-value
pop_500m                 2.961542e-02
pop_2km                  1.716332e-01
dist_hf                  3.471914e-03
pop_size_cohort          4.243391e-02
Ntx                      1.804446e-02
high_season              2.543447e-03
prop_prev_tx             6.519936e-04
pre_int_3000             4.801175e-03
pre_int_2000             1.620036e-02
pre_int_1000             1.382231e-03
pre_int_500              4.995435e-03
n_int_pre_recei          9.544721e-07
pre_int_propdiffarm_500  1.776299e-01
pre_int_propdiffarm_1000 1.395185e-02
age                      1.560636e-04
delta_age                7.444039e-06
response_time            9.065807e-06
[1] "===== variables excluded after lmtest ===== "
 [1] "dist_to_index"            "pop_1km"                 
 [3] "pop_3km"                  "sex"                     
 [5] "dist_hh"                  "tx_cov_cohort"           
 [7] "pre_int_propdiffarm_2000" "pre_int_propdiffarm_3000"
 [9] "delta_response_time"      "delta_dist_index_quant"  
[1] "===== variables excluded after sparsity check ===== "
character(0)
[1] "===== excluded constant variables ===== "
character(0)
[1] "===== variables selected in the end ===== "
 [1] "pop_500m"                 "pop_2km"                 
 [3] "dist_hf"                  "pop_size_cohort"         
 [5] "Ntx"                      "high_season"             
 [7] "prop_prev_tx"             "pre_int_3000"            
 [9] "pre_int_2000"             "pre_int_1000"            
[11] "pre_int_500"              "n_int_pre_recei"         
[13] "pre_int_propdiffarm_500"  "pre_int_propdiffarm_1000"
[15] "age"                      "delta_age"               
[17] "response_time"           
[1] "hTMLE estimation ---------------------------------"
[1] "initial Qbar1W, Qbar0W: 0.007, 0.008"
[1] "updated Qbar1W, Qbar0W: 0.007, 0.008"
450.153 sec elapsed
> toc()
960.097 sec elapsed
> 
> names(res_total_mosq) = c("Long","Short")
> saveRDS(res_total_mosq, file = paste0(results_path, "namibia_htmle_inc_total_mosq_indiv.RDS"))
> 
> # Run hTMLE - Spillover effect ---------------------------------------
> res_spillover_mosq <- list()
> 
> ## Mosquito ---------------------------------------
> tic()
> set.seed(123)
> res_spillover_mosq <- lapply(data_mosq_list, function(x)
+   run_hTMLE(df = x,
+             effecttype = 'spillover',
+             Qlevel = "individual", # cohort/individual/adaptive for incidence, individual for prev
+             glevel = "cohort", # always cohort for incidence, individual for prev
+             dependency = TRUE, # TRUE if we want CIs adjusted for dependency
+             unadj_est = FALSE, # TRUE if we want a unadjusted estimate
+             y_l = 0,
+             y_u = 1,
+             covarname_g = covarname_g,    # set of names for adjustment variables
+             covarname_Q = covarname_Q,
+             SL_lib_Q = SL_lib_Q,
+             SL_lib_g = SL_lib_g,
+             SL_lib_adaQ = SL_lib_simple, # need to specify if for Qlevel = "adaptive"
+             SL_lib_depen = SL_lib_simple, # need to specify if dependency = T
+             verbose = FALSE,
+             reservoir_name = "Mosquito")
+ )
[1] "Fitting htmle model ======================================="
[1] "Covariate screening ---------------------------------"

Likelihood Ratio Test P-values:
                P-value
pre_spray_cover 0.00036
pre_incidence   0.00000
pre_rainfall    0.00000
pop_size_ea     0.00000
pre_evi         0.00000
ea_elevation    0.00000
surface_temp    0.00000


Covariates selected (P<0.2):
                      P-value
pre_spray_cover  3.554926e-04
pre_incidence   2.358635e-271
pre_rainfall    2.492546e-127
pop_size_ea     1.572863e-206
pre_evi          5.139841e-49
ea_elevation    8.622971e-134
surface_temp    3.822180e-131
[1] "===== variables excluded after lmtest ===== "
character(0)
[1] "===== variables excluded after sparsity check ===== "
character(0)
[1] "===== excluded constant variables ===== "
character(0)
[1] "===== variables selected in the end ===== "
[1] "pre_spray_cover" "pre_incidence"   "pre_rainfall"    "pop_size_ea"    
[5] "pre_evi"         "ea_elevation"    "surface_temp"   

Likelihood Ratio Test P-values:
                         P-value
dist_to_index            0.00005
pop_500m                 0.00050
pop_1km                  0.00000
pop_2km                  0.00000
pop_3km                  0.02381
sex                      0.00000
dist_hh                  0.03775
dist_hf                  0.00000
pop_size_cohort          0.31996
Ntx                      0.00000
tx_cov_cohort            0.00034
high_season              0.00013
prop_prev_tx             0.00000
pre_int_3000             0.00000
pre_int_2000             0.00000
pre_int_1000             0.00000
pre_int_500              0.00000
n_int_pre_recei          0.00000
pre_int_propdiffarm_500  0.00009
pre_int_propdiffarm_1000 0.00000
pre_int_propdiffarm_2000 0.01257
pre_int_propdiffarm_3000 0.00000
age                      0.00002
delta_age                0.00000
response_time            0.00000
delta_response_time      0.89806
delta_age.1              0.00000
delta_response_time.1    0.89806
delta_dist_index_quant   0.47741


Covariates selected (P<0.2):
                               P-value
dist_to_index             5.379861e-05
pop_500m                  5.037754e-04
pop_1km                   2.633271e-09
pop_2km                   1.053892e-07
pop_3km                   2.380788e-02
sex                       1.022653e-17
dist_hh                   3.774619e-02
dist_hf                   3.011337e-24
Ntx                       2.045242e-16
tx_cov_cohort             3.446041e-04
high_season               1.252003e-04
prop_prev_tx              4.690474e-86
pre_int_3000              2.719239e-21
pre_int_2000              4.121212e-19
pre_int_1000              2.739803e-79
pre_int_500               1.250975e-29
n_int_pre_recei           2.012556e-78
pre_int_propdiffarm_500   9.392133e-05
pre_int_propdiffarm_1000  1.222442e-29
pre_int_propdiffarm_2000  1.256597e-02
pre_int_propdiffarm_3000  8.997573e-12
age                       2.154509e-05
delta_age                2.435436e-234
response_time             5.851668e-63
delta_age.1              2.435436e-234
[1] "===== variables excluded after lmtest ===== "
[1] "pop_size_cohort"        "delta_response_time"    "delta_dist_index_quant"
[1] "===== variables excluded after sparsity check ===== "
[1] "pre_int_propdiffarm_500"
[1] "===== excluded constant variables ===== "
character(0)
[1] "===== variables selected in the end ===== "
 [1] "dist_to_index"            "pop_500m"                
 [3] "pop_1km"                  "pop_2km"                 
 [5] "pop_3km"                  "sex"                     
 [7] "dist_hh"                  "dist_hf"                 
 [9] "Ntx"                      "tx_cov_cohort"           
[11] "high_season"              "prop_prev_tx"            
[13] "pre_int_3000"             "pre_int_2000"            
[15] "pre_int_1000"             "pre_int_500"             
[17] "n_int_pre_recei"          "pre_int_propdiffarm_1000"
[19] "pre_int_propdiffarm_2000" "pre_int_propdiffarm_3000"
[21] "age"                      "delta_age"               
[23] "response_time"           
11.561 sec elapsed
[1] "Choose Qlevel ---------------------------------"
0 sec elapsed
[1] "Cohort-level covariate screening ---------------------------------"

Likelihood Ratio Test P-values:
                P-value
pre_spray_cover 0.04450
pre_incidence   0.02238
pre_rainfall    0.52252
pop_size_ea     0.44204
pre_evi         0.88871
ea_elevation    0.20749
surface_temp    0.61847


Covariates selected (P<0.2):
                   P-value
pre_spray_cover 0.04450377
pre_incidence   0.02238267
[1] "===== variables excluded after lmtest ===== "
[1] "pre_rainfall" "pop_size_ea"  "pre_evi"      "ea_elevation" "surface_temp"
[1] "===== variables excluded after sparsity check ===== "
character(0)
[1] "===== excluded constant variables ===== "
character(0)
[1] "===== variables selected in the end ===== "
[1] "pre_spray_cover" "pre_incidence"  

Likelihood Ratio Test P-values:
                         P-value
dist_to_index            0.39090
pop_500m                 0.19696
pop_1km                  0.85802
pop_2km                  0.05512
pop_3km                  0.63511
sex                      0.36191
dist_hh                  0.83992
dist_hf                  0.00174
pop_size_cohort          0.21295
Ntx                      0.00597
tx_cov_cohort            0.64709
high_season              0.21768
prop_prev_tx             0.00000
pre_int_3000             0.00007
pre_int_2000             0.00028
pre_int_1000             0.00000
pre_int_500              0.00004
n_int_pre_recei          0.00000
pre_int_propdiffarm_500  0.17817
pre_int_propdiffarm_1000 0.00786
pre_int_propdiffarm_2000 0.41203
pre_int_propdiffarm_3000 0.13064
age                      0.00001
delta_age                0.00000
response_time            0.00000
delta_response_time      0.33941
delta_dist_index_quant   0.75568


Covariates selected (P<0.2):
                              P-value
pop_500m                 1.969558e-01
pop_2km                  5.511899e-02
dist_hf                  1.740245e-03
Ntx                      5.966330e-03
prop_prev_tx             9.255471e-07
pre_int_3000             7.117629e-05
pre_int_2000             2.810635e-04
pre_int_1000             1.826783e-06
pre_int_500              3.766667e-05
n_int_pre_recei          3.203337e-08
pre_int_propdiffarm_500  1.781742e-01
pre_int_propdiffarm_1000 7.856951e-03
pre_int_propdiffarm_3000 1.306373e-01
age                      6.115274e-06
delta_age                6.158630e-07
response_time            3.929424e-06
[1] "===== variables excluded after lmtest ===== "
 [1] "dist_to_index"            "pop_1km"                 
 [3] "pop_3km"                  "sex"                     
 [5] "dist_hh"                  "pop_size_cohort"         
 [7] "tx_cov_cohort"            "high_season"             
 [9] "pre_int_propdiffarm_2000" "delta_response_time"     
[11] "delta_dist_index_quant"  
[1] "===== variables excluded after sparsity check ===== "
character(0)
[1] "===== excluded constant variables ===== "
character(0)
[1] "===== variables selected in the end ===== "
 [1] "pop_500m"                 "pop_2km"                 
 [3] "dist_hf"                  "Ntx"                     
 [5] "prop_prev_tx"             "pre_int_3000"            
 [7] "pre_int_2000"             "pre_int_1000"            
 [9] "pre_int_500"              "n_int_pre_recei"         
[11] "pre_int_propdiffarm_500"  "pre_int_propdiffarm_1000"
[13] "pre_int_propdiffarm_3000" "age"                     
[15] "delta_age"                "response_time"           
[1] "hTMLE estimation ---------------------------------"
[1] "initial Qbar1W, Qbar0W: 0.014, 0.015"
[1] "updated Qbar1W, Qbar0W: 0.014, 0.016"
415.312 sec elapsed
[1] "Fitting htmle model ======================================="
[1] "Covariate screening ---------------------------------"

Likelihood Ratio Test P-values:
                P-value
pre_spray_cover 0.00036
pre_incidence   0.00000
pre_rainfall    0.00000
pop_size_ea     0.00000
pre_evi         0.00000
ea_elevation    0.00000
surface_temp    0.00000


Covariates selected (P<0.2):
                      P-value
pre_spray_cover  3.554926e-04
pre_incidence   2.358635e-271
pre_rainfall    2.492546e-127
pop_size_ea     1.572863e-206
pre_evi          5.139841e-49
ea_elevation    8.622971e-134
surface_temp    3.822180e-131
[1] "===== variables excluded after lmtest ===== "
character(0)
[1] "===== variables excluded after sparsity check ===== "
character(0)
[1] "===== excluded constant variables ===== "
character(0)
[1] "===== variables selected in the end ===== "
[1] "pre_spray_cover" "pre_incidence"   "pre_rainfall"    "pop_size_ea"    
[5] "pre_evi"         "ea_elevation"    "surface_temp"   

Likelihood Ratio Test P-values:
                         P-value
dist_to_index            0.00075
pop_500m                 0.00028
pop_1km                  0.00003
pop_2km                  0.00002
pop_3km                  0.01846
sex                      0.00000
dist_hh                  0.00004
dist_hf                  0.00000
pop_size_cohort          0.59312
Ntx                      0.00000
tx_cov_cohort            0.01465
high_season              0.00000
prop_prev_tx             0.00000
pre_int_3000             0.00000
pre_int_2000             0.00000
pre_int_1000             0.00000
pre_int_500              0.00000
n_int_pre_recei          0.00000
pre_int_propdiffarm_500  0.00132
pre_int_propdiffarm_1000 0.00000
pre_int_propdiffarm_2000 0.21971
pre_int_propdiffarm_3000 0.02937
age                      0.00091
delta_age                0.00000
response_time            0.00000
delta_response_time      0.70382
delta_age.1              0.00000
delta_response_time.1    0.70382
delta_dist_index_quant   0.87561


Covariates selected (P<0.2):
                               P-value
dist_to_index             7.470972e-04
pop_500m                  2.827674e-04
pop_1km                   3.290107e-05
pop_2km                   1.749025e-05
pop_3km                   1.845980e-02
sex                       5.214855e-11
dist_hh                   4.182609e-05
dist_hf                   3.769044e-17
Ntx                       2.031603e-12
tx_cov_cohort             1.465129e-02
high_season               2.272820e-14
prop_prev_tx              4.219577e-33
pre_int_3000              6.072467e-08
pre_int_2000              2.009844e-06
pre_int_1000              4.407890e-36
pre_int_500               1.415087e-11
n_int_pre_recei           1.171294e-44
pre_int_propdiffarm_500   1.315959e-03
pre_int_propdiffarm_1000  2.611406e-21
pre_int_propdiffarm_3000  2.937479e-02
age                       9.119596e-04
delta_age                3.188205e-155
response_time             7.364962e-42
delta_age.1              3.188205e-155
[1] "===== variables excluded after lmtest ===== "
[1] "pop_size_cohort"          "pre_int_propdiffarm_2000"
[3] "delta_response_time"      "delta_dist_index_quant"  
[1] "===== variables excluded after sparsity check ===== "
[1] "pre_int_propdiffarm_500"
[1] "===== excluded constant variables ===== "
character(0)
[1] "===== variables selected in the end ===== "
 [1] "dist_to_index"            "pop_500m"                
 [3] "pop_1km"                  "pop_2km"                 
 [5] "pop_3km"                  "sex"                     
 [7] "dist_hh"                  "dist_hf"                 
 [9] "Ntx"                      "tx_cov_cohort"           
[11] "high_season"              "prop_prev_tx"            
[13] "pre_int_3000"             "pre_int_2000"            
[15] "pre_int_1000"             "pre_int_500"             
[17] "n_int_pre_recei"          "pre_int_propdiffarm_1000"
[19] "pre_int_propdiffarm_3000" "age"                     
[21] "delta_age"                "response_time"           
11.878 sec elapsed
[1] "Choose Qlevel ---------------------------------"
0 sec elapsed
[1] "Cohort-level covariate screening ---------------------------------"

Likelihood Ratio Test P-values:
                P-value
pre_spray_cover 0.04450
pre_incidence   0.02238
pre_rainfall    0.52252
pop_size_ea     0.44204
pre_evi         0.88871
ea_elevation    0.20749
surface_temp    0.61847


Covariates selected (P<0.2):
                   P-value
pre_spray_cover 0.04450377
pre_incidence   0.02238267
[1] "===== variables excluded after lmtest ===== "
[1] "pre_rainfall" "pop_size_ea"  "pre_evi"      "ea_elevation" "surface_temp"
[1] "===== variables excluded after sparsity check ===== "
character(0)
[1] "===== excluded constant variables ===== "
character(0)
[1] "===== variables selected in the end ===== "
[1] "pre_spray_cover" "pre_incidence"  

Likelihood Ratio Test P-values:
                         P-value
dist_to_index            0.80104
pop_500m                 0.16399
pop_1km                  0.92093
pop_2km                  0.26728
pop_3km                  0.30612
sex                      0.04256
dist_hh                  0.58424
dist_hf                  0.00608
pop_size_cohort          0.20100
Ntx                      0.00993
tx_cov_cohort            0.94455
high_season              0.00223
prop_prev_tx             0.00099
pre_int_3000             0.00222
pre_int_2000             0.00755
pre_int_1000             0.00033
pre_int_500              0.00318
n_int_pre_recei          0.00007
pre_int_propdiffarm_500  0.19550
pre_int_propdiffarm_1000 0.01390
pre_int_propdiffarm_2000 0.92918
pre_int_propdiffarm_3000 0.83855
age                      0.00000
delta_age                0.00000
response_time            0.00001
delta_response_time      0.31083
delta_dist_index_quant   0.64326


Covariates selected (P<0.2):
                              P-value
pop_500m                 1.639862e-01
sex                      4.255874e-02
dist_hf                  6.076299e-03
Ntx                      9.931428e-03
high_season              2.226692e-03
prop_prev_tx             9.947748e-04
pre_int_3000             2.219242e-03
pre_int_2000             7.552450e-03
pre_int_1000             3.318321e-04
pre_int_500              3.176864e-03
n_int_pre_recei          6.649215e-05
pre_int_propdiffarm_500  1.955011e-01
pre_int_propdiffarm_1000 1.389807e-02
age                      2.032129e-06
delta_age                6.664796e-07
response_time            1.372562e-05
[1] "===== variables excluded after lmtest ===== "
 [1] "dist_to_index"            "pop_1km"                 
 [3] "pop_2km"                  "pop_3km"                 
 [5] "dist_hh"                  "pop_size_cohort"         
 [7] "tx_cov_cohort"            "pre_int_propdiffarm_2000"
 [9] "pre_int_propdiffarm_3000" "delta_response_time"     
[11] "delta_dist_index_quant"  
[1] "===== variables excluded after sparsity check ===== "
character(0)
[1] "===== excluded constant variables ===== "
character(0)
[1] "===== variables selected in the end ===== "
 [1] "pop_500m"                 "sex"                     
 [3] "dist_hf"                  "Ntx"                     
 [5] "high_season"              "prop_prev_tx"            
 [7] "pre_int_3000"             "pre_int_2000"            
 [9] "pre_int_1000"             "pre_int_500"             
[11] "n_int_pre_recei"          "pre_int_propdiffarm_500" 
[13] "pre_int_propdiffarm_1000" "age"                     
[15] "delta_age"                "response_time"           
[1] "hTMLE estimation ---------------------------------"
[1] "initial Qbar1W, Qbar0W: 0.007, 0.008"
[1] "updated Qbar1W, Qbar0W: 0.007, 0.009"
409.076 sec elapsed
> toc()
868.949 sec elapsed
> 
> names(res_spillover_mosq) = c("Long","Short")
> saveRDS(res_spillover_mosq, file = paste0(results_path, "namibia_htmle_inc_spillover_mosq_indiv.RDS"))
> 
> # Run hTMLE - Direct effect ---------------------------------------
> res_direct_mosq <- list()
> 
> ## Mosquito ---------------------------------------
> tic()
> set.seed(123)
> res_direct_mosq <- lapply(data_mosq_list, function(x)
+   run_hTMLE(df = x,
+             effecttype = 'direct',
+             Qlevel = "individual", # cohort/individual/adaptive for incidence, individual for prev
+             glevel = "cohort", # always cohort for incidence, individual for prev
+             dependency = TRUE, # TRUE if we want CIs adjusted for dependency
+             unadj_est = FALSE, # TRUE if we want a unadjusted estimate
+             y_l = 0,
+             y_u = 1,
+             covarname_g = covarname_g,    # set of names for adjustment variables
+             covarname_Q = covarname_Q,
+             SL_lib_Q = SL_lib_Q,
+             SL_lib_g = SL_lib_g,
+             SL_lib_adaQ = SL_lib_simple, # need to specify if for Qlevel = "adaptive"
+             SL_lib_depen = SL_lib_simple, # need to specify if dependency = T
+             verbose = FALSE,
+             reservoir_name = "Mosquito")
+ )
[1] "Fitting htmle model ======================================="
[1] "Covariate screening ---------------------------------"

Likelihood Ratio Test P-values:
                P-value
pre_spray_cover 0.00000
pre_incidence   0.00000
pre_rainfall    0.81724
pop_size_ea     0.00000
pre_evi         0.00000
ea_elevation    0.00000
surface_temp    0.00000


Covariates selected (P<0.2):
                     P-value
pre_spray_cover 1.491047e-06
pre_incidence   1.971622e-43
pop_size_ea     1.253710e-10
pre_evi         6.290362e-08
ea_elevation    2.823659e-08
surface_temp    6.594756e-08
[1] "===== variables excluded after lmtest ===== "
[1] "pre_rainfall"
[1] "===== variables excluded after sparsity check ===== "
character(0)
[1] "===== excluded constant variables ===== "
character(0)
[1] "===== variables selected in the end ===== "
[1] "pre_spray_cover" "pre_incidence"   "pop_size_ea"     "pre_evi"        
[5] "ea_elevation"    "surface_temp"   

Likelihood Ratio Test P-values:
                         P-value
dist_to_index            0.10080
pop_500m                 0.00946
pop_1km                  0.90246
pop_2km                  0.05345
pop_3km                  0.10292
sex                      0.03713
dist_hh                  0.06856
dist_hf                  0.00329
pop_size_cohort          0.06290
Ntx                      0.00084
tx_cov_cohort            0.45913
high_season              0.52180
prop_prev_tx             0.01822
pre_int_3000             0.61319
pre_int_2000             0.37583
pre_int_1000             0.07827
pre_int_500              0.07448
n_int_pre_recei          0.01397
pre_int_propdiffarm_500  0.14556
pre_int_propdiffarm_1000 0.02491
pre_int_propdiffarm_2000 0.84738
pre_int_propdiffarm_3000 0.68678
age                      0.00047
delta_age                1.00000
response_time            0.00054
delta_response_time      0.31412
delta_age.1              1.00000
delta_response_time.1    0.31412
delta_dist_index_quant   0.49349


Covariates selected (P<0.2):
                              P-value
dist_to_index            0.1007963577
pop_500m                 0.0094586283
pop_2km                  0.0534498631
pop_3km                  0.1029206664
sex                      0.0371320693
dist_hh                  0.0685642000
dist_hf                  0.0032929873
pop_size_cohort          0.0628983264
Ntx                      0.0008379867
prop_prev_tx             0.0182215291
pre_int_1000             0.0782681382
pre_int_500              0.0744800800
n_int_pre_recei          0.0139677565
pre_int_propdiffarm_500  0.1455626748
pre_int_propdiffarm_1000 0.0249070509
age                      0.0004678225
response_time            0.0005395761
[1] "===== variables excluded after lmtest ===== "
 [1] "pop_1km"                  "tx_cov_cohort"           
 [3] "high_season"              "pre_int_3000"            
 [5] "pre_int_2000"             "pre_int_propdiffarm_2000"
 [7] "pre_int_propdiffarm_3000" "delta_age"               
 [9] "delta_response_time"      "delta_dist_index_quant"  
[1] "===== variables excluded after sparsity check ===== "
[1] "pre_int_propdiffarm_500"
[1] "===== excluded constant variables ===== "
[1] "delta_age"
[1] "===== variables selected in the end ===== "
 [1] "dist_to_index"            "pop_500m"                
 [3] "pop_2km"                  "pop_3km"                 
 [5] "sex"                      "dist_hh"                 
 [7] "dist_hf"                  "pop_size_cohort"         
 [9] "Ntx"                      "prop_prev_tx"            
[11] "pre_int_1000"             "pre_int_500"             
[13] "n_int_pre_recei"          "pre_int_propdiffarm_1000"
[15] "age"                      "response_time"           
[1] "Warning: number of events per variable < 10"
1.465 sec elapsed
[1] "Choose Qlevel ---------------------------------"
0 sec elapsed
[1] "Cohort-level covariate screening ---------------------------------"

Likelihood Ratio Test P-values:
                P-value
pre_spray_cover 0.04450
pre_incidence   0.02238
pre_rainfall    0.52252
pop_size_ea     0.44204
pre_evi         0.88871
ea_elevation    0.20749
surface_temp    0.61847


Covariates selected (P<0.2):
                   P-value
pre_spray_cover 0.04450377
pre_incidence   0.02238267
[1] "===== variables excluded after lmtest ===== "
[1] "pre_rainfall" "pop_size_ea"  "pre_evi"      "ea_elevation" "surface_temp"
[1] "===== variables excluded after sparsity check ===== "
character(0)
[1] "===== excluded constant variables ===== "
character(0)
[1] "===== variables selected in the end ===== "
[1] "pre_spray_cover" "pre_incidence"  

Likelihood Ratio Test P-values:
                         P-value
dist_to_index            0.44867
pop_500m                 0.19856
pop_1km                  0.34961
pop_2km                  0.21777
pop_3km                  0.14044
sex                      0.89784
dist_hh                  0.31626
dist_hf                  0.02871
pop_size_cohort          0.17474
Ntx                      0.00198
tx_cov_cohort            0.66902
high_season              0.84556
prop_prev_tx             0.06256
pre_int_3000             0.57716
pre_int_2000             0.63350
pre_int_1000             0.28297
pre_int_500              0.13147
n_int_pre_recei          0.00202
pre_int_propdiffarm_500  0.30616
pre_int_propdiffarm_1000 0.15938
pre_int_propdiffarm_2000 0.77458
pre_int_propdiffarm_3000 0.77968
age                      0.74756
delta_age                1.00000
response_time            0.04065
delta_response_time      0.62509
delta_dist_index_quant   0.19461


Covariates selected (P<0.2):
                             P-value
pop_500m                 0.198556093
pop_3km                  0.140437504
dist_hf                  0.028713345
pop_size_cohort          0.174744543
Ntx                      0.001982059
prop_prev_tx             0.062562703
pre_int_500              0.131465040
n_int_pre_recei          0.002015520
pre_int_propdiffarm_1000 0.159379797
response_time            0.040654864
delta_dist_index_quant   0.194611717
[1] "===== variables excluded after lmtest ===== "
 [1] "dist_to_index"            "pop_1km"                 
 [3] "pop_2km"                  "sex"                     
 [5] "dist_hh"                  "tx_cov_cohort"           
 [7] "high_season"              "pre_int_3000"            
 [9] "pre_int_2000"             "pre_int_1000"            
[11] "pre_int_propdiffarm_500"  "pre_int_propdiffarm_2000"
[13] "pre_int_propdiffarm_3000" "age"                     
[15] "delta_age"                "delta_response_time"     
[1] "===== variables excluded after sparsity check ===== "
[1] "pre_int_propdiffarm_500"
[1] "===== excluded constant variables ===== "
[1] "delta_age"
[1] "===== variables selected in the end ===== "
 [1] "pop_500m"                 "pop_3km"                 
 [3] "dist_hf"                  "pop_size_cohort"         
 [5] "Ntx"                      "prop_prev_tx"            
 [7] "pre_int_500"              "n_int_pre_recei"         
 [9] "pre_int_propdiffarm_1000" "response_time"           
[11] "delta_dist_index_quant"  
[1] "hTMLE estimation ---------------------------------"
[1] "initial Qbar1W, Qbar0W: 0.009, 0.007"
[1] "updated Qbar1W, Qbar0W: 0.008, 0.007"
43.686 sec elapsed
[1] "Fitting htmle model ======================================="
[1] "Too few observations to fit adjusted model"
[1] "Choose Qlevel ---------------------------------"
0 sec elapsed
[1] "hTMLE estimation ---------------------------------"
[1] "initial Qbar1W, Qbar0W: 0.005, 0.002"
[1] "updated Qbar1W, Qbar0W: 0.005, 0.002"
3.789 sec elapsed
Warning message:
glm.fit: fitted probabilities numerically 0 or 1 occurred 
> toc()
63.96 sec elapsed
> 
> names(res_direct_mosq) = c("Long","Short")
> saveRDS(res_direct_mosq, file = paste0(results_path, "namibia_htmle_inc_direct_mosq_indiv.RDS"))
> 
> 
> 
> 
> 
> 
> proc.time()
    user   system  elapsed 
2754.251 2884.784 1902.730 
